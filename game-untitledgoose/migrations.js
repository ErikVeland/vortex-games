"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.migrate020 = migrate020;
const path_1 = __importDefault(require("path"));
const semver_1 = __importDefault(require("semver"));
const vortex_api_1 = require("vortex-api");
const statics_1 = require("./statics");
const util_1 = require("./util");
function migrate020(context, oldVersion) {
    if (semver_1.default.gte(oldVersion, '0.2.0')) {
        return Promise.resolve();
    }
    const discoveryPath = (0, util_1.getDiscoveryPath)(context.api.getState());
    if (discoveryPath === undefined) {
        return Promise.resolve();
    }
    const modsPath = path_1.default.join(discoveryPath, statics_1.DATAPATH, 'VortexMods');
    return context.api.awaitUI()
        .then(() => vortex_api_1.fs.ensureDirWritableAsync(modsPath))
        .then(() => context.api.emitAndAwait('purge-mods-in-path', statics_1.GAME_ID, '', modsPath));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWlncmF0aW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1pZ3JhdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFnQ0EsZ0NBZ0JDO0FBL0NELGdEQUF3QjtBQUN4QixvREFBNEI7QUFDNUIsMkNBQWdDO0FBRWhDLHVDQUEyRDtBQUMzRCxpQ0FBMEM7QUEwQjFDLFNBQWdCLFVBQVUsQ0FBQyxPQUFPLEVBQUUsVUFBVTtJQUM1QyxJQUFJLGdCQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQ3BDLE9BQU8sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQzNCLENBQUM7SUFFRCxNQUFNLGFBQWEsR0FBRyxJQUFBLHVCQUFnQixFQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUMvRCxJQUFJLGFBQWEsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUdoQyxPQUFPLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBQ0QsTUFBTSxRQUFRLEdBQUcsY0FBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsa0JBQVEsRUFBRSxZQUFZLENBQUMsQ0FBQztJQUVsRSxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFO1NBQ3pCLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxlQUFFLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDL0MsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLG9CQUFvQixFQUFFLGlCQUFPLEVBQUUsRUFBRSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7QUFDdkYsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCB7IHJ1blBhdGNoZXIgfSBmcm9tICdoYXJtb255LXBhdGNoZXInO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgc2VtdmVyIGZyb20gJ3NlbXZlcic7XG5pbXBvcnQgeyBmcyB9IGZyb20gJ3ZvcnRleC1hcGknO1xuXG5pbXBvcnQgeyBEQVRBUEFUSCwgRU5UUllfUE9JTlQsIEdBTUVfSUQgfSBmcm9tICcuL3N0YXRpY3MnO1xuaW1wb3J0IHsgZ2V0RGlzY292ZXJ5UGF0aCB9IGZyb20gJy4vdXRpbCc7XG5cbi8qXG5leHBvcnQgZnVuY3Rpb24gbWlncmF0ZTAxMChjb250ZXh0LCBvbGRWZXJzaW9uKSB7XG4gIGlmIChzZW12ZXIuZ3RlKG9sZFZlcnNpb24sICcwLjEuMCcpKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgY29uc3Qgc3RhdGUgPSBjb250ZXh0LmFwaS5zdG9yZS5nZXRTdGF0ZSgpO1xuICBjb25zdCBkaXNjb3ZlcnlQYXRoID0gZ2V0RGlzY292ZXJ5UGF0aChzdGF0ZSk7XG4gIGlmIChkaXNjb3ZlcnlQYXRoID09PSB1bmRlZmluZWQpIHtcbiAgICAvLyBHYW1lIHdhcyBub3QgZGlzY292ZXJlZCwgdGhpcyBpcyBhIHZhbGlkIHVzZSBjYXNlLlxuICAgIC8vICBVc2VyIG1pZ2h0IG5vdCBvd24gdGhlIGdhbWUuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgY29uc3QgYWJzUGF0aCA9IHBhdGguam9pbihkaXNjb3ZlcnlQYXRoLCBEQVRBUEFUSCk7XG4gIGNvbnN0IGFzc2VtYmx5UGF0aCA9IHBhdGguam9pbihhYnNQYXRoLCAnVm9ydGV4SGFybW9ueUluc3RhbGxlci5kbGwnKTtcbiAgLy8gVGVzdCBpZiB0aGUgcGF0Y2ggZXhpc3RzIGFuZCByZW1vdmUgaXQsIGlmIGl0IGlzLlxuICByZXR1cm4gZnMuc3RhdEFzeW5jKGFzc2VtYmx5UGF0aClcbiAgICAudGhlbigoKSA9PiBydW5QYXRjaGVyKF9fZGlybmFtZSwgYWJzUGF0aCwgRU5UUllfUE9JTlQsIHRydWUsXG4gICAgICBwYXRoLmpvaW4oZ2V0RGlzY292ZXJ5UGF0aChzdGF0ZSksIERBVEFQQVRILCAnVm9ydGV4TW9kcycpKSlcbiAgICAuY2F0Y2goZXJyID0+IGVyci5jb2RlID09PSAnRU5PRU5UJyA/IFByb21pc2UucmVzb2x2ZSgpIDogUHJvbWlzZS5yZWplY3QoZXJyKSk7XG59XG4qL1xuXG5leHBvcnQgZnVuY3Rpb24gbWlncmF0ZTAyMChjb250ZXh0LCBvbGRWZXJzaW9uKSB7XG4gIGlmIChzZW12ZXIuZ3RlKG9sZFZlcnNpb24sICcwLjIuMCcpKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgY29uc3QgZGlzY292ZXJ5UGF0aCA9IGdldERpc2NvdmVyeVBhdGgoY29udGV4dC5hcGkuZ2V0U3RhdGUoKSk7XG4gIGlmIChkaXNjb3ZlcnlQYXRoID09PSB1bmRlZmluZWQpIHtcbiAgICAvLyBHYW1lIHdhcyBub3QgZGlzY292ZXJlZCwgdGhpcyBpcyBhIHZhbGlkIHVzZSBjYXNlLlxuICAgIC8vICBVc2VyIG1pZ2h0IG5vdCBvd24gdGhlIGdhbWUuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG4gIGNvbnN0IG1vZHNQYXRoID0gcGF0aC5qb2luKGRpc2NvdmVyeVBhdGgsIERBVEFQQVRILCAnVm9ydGV4TW9kcycpO1xuXG4gIHJldHVybiBjb250ZXh0LmFwaS5hd2FpdFVJKClcbiAgICAudGhlbigoKSA9PiBmcy5lbnN1cmVEaXJXcml0YWJsZUFzeW5jKG1vZHNQYXRoKSlcbiAgICAudGhlbigoKSA9PiBjb250ZXh0LmFwaS5lbWl0QW5kQXdhaXQoJ3B1cmdlLW1vZHMtaW4tcGF0aCcsIEdBTUVfSUQsICcnLCBtb2RzUGF0aCkpO1xufVxuIl19