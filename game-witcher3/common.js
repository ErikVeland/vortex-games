"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ACTIVITY_ID_IMPORTING_LOADORDER = exports.NON_SORTABLE = exports.SCRIPT_MERGER_FILES = exports.DO_NOT_DEPLOY = exports.DO_NOT_DISPLAY = exports.LOCKED_PREFIX = exports.UNI_PATCH = exports.W3_TEMP_DATA_DIR = exports.CONFIG_MATRIX_FILES = exports.CONFIG_MATRIX_REL_PATH = exports.I18N_NAMESPACE = exports.LOAD_ORDER_FILENAME = exports.MERGE_INV_MANIFEST = exports.SCRIPT_MERGER_ID = exports.PART_SUFFIX = exports.VORTEX_BACKUP_TAG = exports.INPUT_XML_FILENAME = exports.GAME_ID = exports.MergeDataViolationError = exports.ResourceInaccessibleError = exports.MD5ComparisonError = void 0;
exports.calcHashImpl = calcHashImpl;
exports.getHash = getHash;
exports.getLoadOrderFilePath = getLoadOrderFilePath;
exports.getPriorityTypeBranch = getPriorityTypeBranch;
exports.getSuppressModLimitBranch = getSuppressModLimitBranch;
const crypto_1 = __importDefault(require("crypto"));
const path_1 = __importDefault(require("path"));
const vortex_api_1 = require("vortex-api");
class MD5ComparisonError extends Error {
    constructor(message, file) {
        super(message);
        this.mPath = file;
    }
    get affectedFile() {
        return this.mPath;
    }
    get errorMessage() {
        return this.message + ': ' + this.mPath;
    }
}
exports.MD5ComparisonError = MD5ComparisonError;
class ResourceInaccessibleError extends Error {
    constructor(filePath, allowReport = false) {
        super(`"${filePath}" is being manipulated by another process`);
        this.mFilePath = filePath;
        this.mIsReportingAllowed = allowReport;
    }
    get isOneDrive() {
        const segments = this.mFilePath.split(path_1.default.sep)
            .filter(seg => !!seg)
            .map(seg => seg.toLowerCase());
        return segments.includes('onedrive');
    }
    get allowReport() {
        return this.mIsReportingAllowed;
    }
    get errorMessage() {
        return (this.isOneDrive)
            ? this.message + ': ' + 'probably by the OneDrive service.'
            : this.message + ': ' + 'close all applications that may be using this file.';
    }
}
exports.ResourceInaccessibleError = ResourceInaccessibleError;
class MergeDataViolationError extends Error {
    constructor(notIncluded, optional, collectionName) {
        super(`Merged script data for ${collectionName} is referencing missing/undeployed/optional mods`);
        this.name = 'MergeDataViolationError';
        this.mOptional = optional;
        this.mNotIncluded = notIncluded;
        this.mCollectionName = collectionName;
    }
    get Optional() {
        return this.mOptional;
    }
    get NotIncluded() {
        return this.mNotIncluded;
    }
    get CollectionName() {
        return this.mCollectionName;
    }
}
exports.MergeDataViolationError = MergeDataViolationError;
function calcHashImpl(filePath) {
    return new Promise((resolve, reject) => {
        const hash = crypto_1.default.createHash('md5');
        const stream = vortex_api_1.fs.createReadStream(filePath);
        stream.on('readable', () => {
            const data = stream.read();
            if (data) {
                hash.update(data);
            }
        });
        stream.on('end', () => resolve(hash.digest('hex')));
        stream.on('error', reject);
    });
}
function getHash(filePath, tries = 3) {
    return calcHashImpl(filePath)
        .catch(err => {
        if (['EMFILE', 'EBADF'].includes(err['code']) && (tries > 0)) {
            return getHash(filePath, tries - 1);
        }
        else {
            return Promise.reject(err);
        }
    });
}
function getLoadOrderFilePath() {
    return path_1.default.join(vortex_api_1.util.getVortexPath('documents'), 'The Witcher 3', exports.LOAD_ORDER_FILENAME);
}
function getPriorityTypeBranch() {
    return ['settings', 'witcher3', 'prioritytype'];
}
function getSuppressModLimitBranch() {
    return ['settings', 'witcher3', 'suppressModLimitPatch'];
}
exports.GAME_ID = 'witcher3';
exports.INPUT_XML_FILENAME = 'input.xml';
exports.VORTEX_BACKUP_TAG = '.vortex_backup';
exports.PART_SUFFIX = '.part.txt';
exports.SCRIPT_MERGER_ID = 'W3ScriptMerger';
exports.MERGE_INV_MANIFEST = 'MergeInventory.xml';
exports.LOAD_ORDER_FILENAME = 'mods.settings';
exports.I18N_NAMESPACE = 'game-witcher3';
exports.CONFIG_MATRIX_REL_PATH = path_1.default.join('bin', 'config', 'r4game', 'user_config_matrix', 'pc');
exports.CONFIG_MATRIX_FILES = ['audio', 'display', 'gameplay', 'gamma', 'graphics',
    'graphicsdx11', 'hdr', 'hidden', 'hud', 'input', 'localization'];
exports.W3_TEMP_DATA_DIR = path_1.default.join(vortex_api_1.util.getVortexPath('temp'), 'W3TempData');
exports.UNI_PATCH = 'mod0000____CompilationTrigger';
exports.LOCKED_PREFIX = 'mod0000_';
exports.DO_NOT_DISPLAY = ['communitypatch-base'];
exports.DO_NOT_DEPLOY = ['README.TXT', `**/*${exports.PART_SUFFIX.toUpperCase()}`];
exports.SCRIPT_MERGER_FILES = ['WitcherScriptMerger.exe'];
exports.NON_SORTABLE = ['witcher3menumoddocuments', 'collection'];
exports.ACTIVITY_ID_IMPORTING_LOADORDER = 'activity-witcher3-importing-loadorder';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29tbW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQStFQSxvQ0FhQztBQUVELDBCQVNDO0FBRUQsb0RBRUM7QUFFRCxzREFFQztBQUVELDhEQUVDO0FBbkhELG9EQUE0QjtBQUM1QixnREFBd0I7QUFDeEIsMkNBQXNDO0FBQ3RDLE1BQWEsa0JBQW1CLFNBQVEsS0FBSztJQUUzQyxZQUFZLE9BQU8sRUFBRSxJQUFJO1FBQ3ZCLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxJQUFJLFlBQVk7UUFDZCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDcEIsQ0FBQztJQUVELElBQUksWUFBWTtRQUNkLE9BQU8sSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztJQUMxQyxDQUFDO0NBQ0Y7QUFkRCxnREFjQztBQUVELE1BQWEseUJBQTBCLFNBQVEsS0FBSztJQUdsRCxZQUFZLFFBQVEsRUFBRSxXQUFXLEdBQUcsS0FBSztRQUN2QyxLQUFLLENBQUMsSUFBSSxRQUFRLDJDQUEyQyxDQUFDLENBQUM7UUFDL0QsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7UUFDMUIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLFdBQVcsQ0FBQztJQUN6QyxDQUFDO0lBRUQsSUFBSSxVQUFVO1FBQ1osTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsY0FBSSxDQUFDLEdBQUcsQ0FBQzthQUM1QyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO2FBQ3BCLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO1FBQ2pDLE9BQU8sUUFBUSxD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RXpDLFFBQUEsYUFBYSxHQUFHLENBQUMsWUFBWSxFQUFFLE9BQU8sbUJBQVcsQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDbkUsUUFBQSxtQkFBbUIsR0FBRyxDQUFDLHlCQUF5QixDQUFDLENBQUM7QUFFbEQsUUFBQSxZQUFZLEdBQUcsQ0FBQywwQkFBMEIsRUFBRSxZQUFZLENBQUMsQ0FBQztBQUUxRCxRQUFBLCtCQUErQixHQUFHLHVDQUF1QyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNyeXB0byBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBmcywgdXRpbCB9IGZyb20gJ3ZvcnRleC1hcGknO1xuZXhwb3J0IGNsYXNzIE1ENUNvbXBhcmlzb25FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgcHJpdmF0ZSBtUGF0aDtcbiAgY29uc3RydWN0b3IobWVzc2FnZSwgZmlsZSkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubVBhdGggPSBmaWxlO1xuICB9XG5cbiAgZ2V0IGFmZmVjdGVkRmlsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5tUGF0aDtcbiAgfVxuXG4gIGdldCBlcnJvck1lc3NhZ2UoKSB7XG4gICAgcmV0dXJuIHRoaXMubWVzc2FnZSArICc6ICcgKyB0aGlzLm1QYXRoO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBSZXNvdXJjZUluYWNjZXNzaWJsZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBwcml2YXRlIG1Jc1JlcG9ydGluZ0FsbG93ZWQ7XG4gIHByaXZhdGUgbUZpbGVQYXRoO1xuICBjb25zdHJ1Y3RvcihmaWxlUGF0aCwgYWxsb3dSZXBvcnQgPSBmYWxzZSkge1xuICAgIHN1cGVyKGBcIiR7ZmlsZVBhdGh9XCIgaXMgYmVpbmcgbWFuaXB1bGF0ZWQgYnkgYW5vdGhlciBwcm9jZXNzYCk7XG4gICAgdGhpcy5tRmlsZVBhdGggPSBmaWxlUGF0aDtcbiAgICB0aGlzLm1Jc1JlcG9ydGluZ0FsbG93ZWQgPSBhbGxvd1JlcG9ydDtcbiAgfVxuXG4gIGdldCBpc09uZURyaXZlKCkge1xuICAgIGNvbnN0IHNlZ21lbnRzID0gdGhpcy5tRmlsZVBhdGguc3BsaXQocGF0aC5zZXApXG4gICAgICAuZmlsdGVyKHNlZyA9PiAhIXNlZylcbiAgICAgIC5tYXAoc2VnID0+IHNlZy50b0xvd2VyQ2FzZSgpKTtcbiAgICByZXR1cm4gc2VnbWVudHMuaW5jbHVkZXMoJ29uZWRyaXZlJyk7XG4gIH1cblxuICBnZXQgYWxsb3dSZXBvcnQoKSB7XG4gICAgcmV0dXJuIHRoaXMubUlzUmVwb3J0aW5nQWxsb3dlZDtcbiAgfVxuXG4gIGdldCBlcnJvck1lc3NhZ2UoKSB7XG4gICAgcmV0dXJuICh0aGlzLmlzT25lRHJpdmUpXG4gICAgICA/IHRoaXMubWVzc2FnZSArICc6ICcgKyAncHJvYmFibHkgYnkgdGhlIE9uZURyaXZlIHNlcnZpY2UuJ1xuICAgICAgOiB0aGlzLm1lc3NhZ2UgKyAnOiAnICsgJ2Nsb3NlIGFsbCBhcHBsaWNhdGlvbnMgdGhhdCBtYXkgYmUgdXNpbmcgdGhpcyBmaWxlLic7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgTWVyZ2VEYXRhVmlvbGF0aW9uRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIC8vIE1lcmdlIGRhdGEgdmlvbGF0aW9uIGVycm9ycyBpbnRlbmRzIHRvIGNhdGVyIGZvci9ibG9jayBjdXJhdG9yc1xuICAvLyAgZnJvbSB1cGxvYWRpbmcgYSBjb2xsZWN0aW9uIHdpdGggZmF1bHR5IG1lcmdlZCBkYXRhLlxuICAvLyBXZSBkZWZpbmUgZmF1bHR5IG1lcmdlZCBkYXRhIGFzOlxuICAvLyAgMS4gQSBtZXJnZWQgc2NyaXB0IHNlZ21lbnQgd2hpY2ggcmVsaWVzIG9uIGEgY2VydGFpbiBtb2QgdG8gYmUgaW5jbHVkZWQgaW4gdGhlXG4gIC8vICAgICBjb2xsZWN0aW9uLCB5ZXQgaXQgaXMgbm90IGluY2x1ZGVkLlxuICAvLyAgMi4gQSBtZXJnZWQgc2NyaXB0IHNlZ21lbnQgd2hpY2ggcmVxdWlyZXMgYSBzcGVjaWZpYyBtb2QgdG8gYmUgaW5zdGFsbGVkLFxuICAvLyAgICAgeWV0IHRoZSBjb2xsZWN0aW9uIGhpZ2hsaWdodGVkIHNhaWQgbW9kIGFzIFwib3B0aW9uYWxcIjsgcG90ZW50aWFsbHlcbiAgLy8gICAgIHJlc3VsdGluZyBpbiB0aGUgbW9kIGJlaW5nIG1pc3Npbmcgb24gdGhlIHVzZXIgZW5kLlxuICBwcml2YXRlIG1Ob3RJbmNsdWRlZDogc3RyaW5nW107XG4gIHByaXZhdGUgbU9wdGlvbmFsOiBzdHJpbmdbXTtcbiAgcHJpdmF0ZSBtQ29sbGVjdGlvbk5hbWU6IHN0cmluZztcbiAgY29uc3RydWN0b3Iobm90SW5jbHVkZWQ6IHN0cmluZ1tdLCBvcHRpb25hbDogc3RyaW5nW10sIGNvbGxlY3Rpb25OYW1lOiBzdHJpbmcpIHtcbiAgICBzdXBlcihgTWVyZ2VkIHNjcmlwdCBkYXRhIGZvciAke2NvbGxlY3Rpb25OYW1lfSBpcyByZWZlcmVuY2luZyBtaXNzaW5nL3VuZGVwbG95ZWQvb3B0aW9uYWwgbW9kc2ApO1xuICAgIHRoaXMubmFtZSA9ICdNZXJnZURhdGFWaW9sYXRpb25FcnJvcic7XG4gICAgdGhpcy5tT3B0aW9uYWwgPSBvcHRpb25hbDtcbiAgICB0aGlzLm1Ob3RJbmNsdWRlZCA9IG5vdEluY2x1ZGVkO1xuICAgIHRoaXMubUNvbGxlY3Rpb25OYW1lID0gY29sbGVjdGlvbk5hbWU7XG4gIH1cblxuICBwdWJsaWMgZ2V0IE9wdGlvbmFsKCkge1xuICAgIHJldHVybiB0aGlzLm1PcHRpb25hbDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgTm90SW5jbHVkZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMubU5vdEluY2x1ZGVkO1xuICB9XG5cbiAgcHVibGljIGdldCBDb2xsZWN0aW9uTmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5tQ29sbGVjdGlvbk5hbWVcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY0hhc2hJbXBsKGZpbGVQYXRoKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgaGFzaCA9IGNyeXB0by5jcmVhdGVIYXNoKCdtZDUnKTtcbiAgICBjb25zdCBzdHJlYW0gPSBmcy5jcmVhdGVSZWFkU3RyZWFtKGZpbGVQYXRoKTtcbiAgICBzdHJlYW0ub24oJ3JlYWRhYmxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YSA9IHN0cmVhbS5yZWFkKCk7XG4gICAgICBpZiAoZGF0YSkge1xuICAgICAgICBoYXNoLnVwZGF0ZShkYXRhKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBzdHJlYW0ub24oJ2VuZCcsICgpID0+IHJlc29sdmUoaGFzaC5kaWdlc3QoJ2hleCcpKSk7XG4gICAgc3RyZWFtLm9uKCdlcnJvcicsIHJlamVjdCk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0SGFzaChmaWxlUGF0aCwgdHJpZXMgPSAzKSB7XG4gIHJldHVybiBjYWxjSGFzaEltcGwoZmlsZVBhdGgpXG4gICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICBpZiAoWydFTUZJTEUnLCAnRUJBREYnXS5pbmNsdWRlcyhlcnJbJ2NvZGUnXSkgJiYgKHRyaWVzID4gMCkpIHtcbiAgICAgICAgcmV0dXJuIGdldEhhc2goZmlsZVBhdGgsIHRyaWVzIC0gMSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExvYWRPcmRlckZpbGVQYXRoKCkge1xuICByZXR1cm4gcGF0aC5qb2luKHV0aWwuZ2V0Vm9ydGV4UGF0aCgnZG9jdW1lbnRzJyksICdUaGUgV2l0Y2hlciAzJywgTE9BRF9PUkRFUl9GSUxFTkFNRSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQcmlvcml0eVR5cGVCcmFuY2goKSB7XG4gIHJldHVybiBbJ3NldHRpbmdzJywgJ3dpdGNoZXIzJywgJ3ByaW9yaXR5dHlwZSddO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3VwcHJlc3NNb2RMaW1pdEJyYW5jaCgpIHtcbiAgcmV0dXJuIFsnc2V0dGluZ3MnLCAnd2l0Y2hlcjMnLCAnc3VwcHJlc3NNb2RMaW1pdFBhdGNoJ107XG59XG5cbmV4cG9ydCBjb25zdCBHQU1FX0lEID0gJ3dpdGNoZXIzJztcblxuLy8gRmlsZSB1c2VkIGJ5IHNvbWUgbW9kcyB0byBkZWZpbmUgaG90a2V5L2lucHV0IG1hcHBpbmdcbmV4cG9ydCBjb25zdCBJTlBVVF9YTUxfRklMRU5BTUUgPSAnaW5wdXQueG1sJztcblxuLy8gVGhlIG9yaWdpbmFsIGZpbGUgaXMgYmFja2VkIHVwIG9uIGRlcGxveW1lbnQgLSB3ZSB3aWxsIHVzZSB0aGUgYmFja3VwXG4vLyAgZHVyaW5nIG1lcmdlcyBpZiBpdCBleGlzdHMuXG5leHBvcnQgY29uc3QgVk9SVEVYX0JBQ0tVUF9UQUcgPSAnLnZvcnRleF9iYWNrdXAnO1xuXG4vLyBUaGUgVzNNTSBtZW51IG1vZCBwYXR0ZXJuIHNlZW1zIHRvIGVuZm9yY2UgYSBtb2RkaW5nIHBhdHRlcm5cbi8vICB3aGVyZSB7ZmlsZW5hbWV9LnBhcnQudHh0IGhvbGRzIGEgZGlmZiBvZiB3aGF0IG5lZWRzIHRvIGJlXG4vLyAgYWRkZWQgdG8gdGhlIG9yaWdpbmFsIGZpbGUgLSB3ZSdyZSBnb2luZyB0byB1c2UgdGhpcyBwYXR0ZXJuIGFzIHdlbGwuXG5leHBvcnQgY29uc3QgUEFSVF9TVUZGSVggPSAnLnBhcnQudHh0JztcblxuZXhwb3J0IGNvbnN0IFNDUklQVF9NRVJHRVJfSUQgPSAnVzNTY3JpcHRNZXJnZXInO1xuZXhwb3J0IGNvbnN0IE1FUkdFX0lOVl9NQU5JRkVTVCA9ICdNZXJnZUludmVudG9yeS54bWwnO1xuZXhwb3J0IGNvbnN0IExPQURfT1JERVJfRklMRU5BTUUgPSAnbW9kcy5zZXR0aW5ncyc7XG5leHBvcnQgY29uc3QgSTE4Tl9OQU1FU1BBQ0UgPSAnZ2FtZS13aXRjaGVyMyc7XG5leHBvcnQgY29uc3QgQ09ORklHX01BVFJJWF9SRUxfUEFUSCA9IHBhdGguam9pbignYmluJywgJ2NvbmZpZycsICdyNGdhbWUnLCAndXNlcl9jb25maWdfbWF0cml4JywgJ3BjJyk7XG5leHBvcnQgY29uc3QgQ09ORklHX01BVFJJWF9GSUxFUyA9IFsnYXVkaW8nLCAnZGlzcGxheScsICdnYW1lcGxheScsICdnYW1tYScsICdncmFwaGljcycsXG4gICdncmFwaGljc2R4MTEnLCAnaGRyJywgJ2hpZGRlbicsICdodWQnLCAnaW5wdXQnLCAnbG9jYWxpemF0aW9uJ107XG5cbmV4cG9ydCBjb25zdCBXM19URU1QX0RBVEFfRElSID0gcGF0aC5qb2luKHV0aWwuZ2V0Vm9ydGV4UGF0aCgndGVtcCcpLCAnVzNUZW1wRGF0YScpO1xuXG5leHBvcnQgY29uc3QgVU5JX1BBVENIID0gJ21vZDAwMDBfX19fQ29tcGlsYXRpb25UcmlnZ2VyJztcbmV4cG9ydCBjb25zdCBMT0NLRURfUFJFRklYID0gJ21vZDAwMDBfJztcblxuZXhwb3J0IGNvbnN0IERPX05PVF9ESVNQTEFZID0gWydjb21tdW5pdHlwYXRjaC1iYXNlJ107XG4vLyBtaW5pbWF0Y2ggaXMgc3VwcG9zZWQgdG8gYmUgY2FzZS1pbnNlbnNpdGl2ZSwgYnV0IGl0J3Mgbm90IHdvcmtpbmcgZm9yIHNvbWUgcmVhc29uLi4uXG5leHBvcnQgY29uc3QgRE9fTk9UX0RFUExPWSA9IFsnUkVBRE1FLlRYVCcsIGAqKi8qJHtQQVJUX1NVRkZJWC50b1VwcGVyQ2FzZSgpfWBdO1xuZXhwb3J0IGNvbnN0IFNDUklQVF9NRVJHRVJfRklMRVMgPSBbJ1dpdGNoZXJTY3JpcHRNZXJnZXIuZXhlJ107XG5cbmV4cG9ydCBjb25zdCBOT05fU09SVEFCTEUgPSBbJ3dpdGNoZXIzbWVudW1vZGRvY3VtZW50cycsICdjb2xsZWN0aW9uJ107XG5cbmV4cG9ydCBjb25zdCBBQ1RJVklUWV9JRF9JTVBPUlRJTkdfTE9BRE9SREVSID0gJ2FjdGl2aXR5LXdpdGNoZXIzLWltcG9ydGluZy1sb2Fkb3JkZXInOyJdfQ==